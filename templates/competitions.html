{% extends 'layout.html' %}

{% block title %}Leagues{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/competitions.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="header">
        <h1>üèÜ Leagues</h1>
        <p>All leagues, cups and special tournaments in world football</p>
    </div>

    <form method="get" class="filter-bar fade-in">
        <div class="filter-group">
            <button type="button" class="filter-btn" id="countryDropdownBtn">
                Country: <span id="countryButtonLabel">
                    {% if selected_country %}{{ selected_country }}{% else %}Select country{% endif %}
                </span>
            </button>
            <div class="filter-dropdown" id="countryDropdown">
                <ul>
                    <li class="sort-item" data-value="" data-label="Select country">
                        <span>Select country</span>
                    </li>
                    <div class="separator"></div>
                    {% for country in countries %}
                    <li class="sort-item {% if country == selected_country %}active{% endif %}" data-value="{{ country }}" data-label="{{ country }}">
                        <span>{{ country }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <input type="hidden" name="country" id="countryInput" value="{{ selected_country or '' }}" required>
        </div>

        <div class="filter-group">
            <button type="button" class="filter-btn" id="majorLeagueDropdownBtn">
                Major League: <span id="majorLeagueButtonLabel">
                    {% if selected_is_major_league == "true" %}Yes{% elif selected_is_major_league == "false" %}No{% else %}All{% endif %}
                </span>
            </button>
            <div class="filter-dropdown" id="majorLeagueDropdown">
                <ul>
                    <li class="sort-item {% if not selected_is_major_league %}active{% endif %}" data-value="" data-label="All">
                        <span>All</span>
                    </li>
                    <div class="separator"></div>
                    <li class="sort-item {% if selected_is_major_league == "true" %}active{% endif %}" data-value="true" data-label="Yes">
                        <span>Yes</span>
                    </li>
                    <li class="sort-item {% if selected_is_major_league == "false" %}active{% endif %}" data-value="false" data-label="No">
                        <span>No</span>
                    </li>
                </ul>
            </div>
            <input type="hidden" name="is_major_league" id="majorLeagueInput" value="{{ selected_is_major_league or '' }}">
        </div>

        <button type="submit" class="apply-btn">Apply Filter</button>
    </form>

    {% if selected_country %}
        {% if competitions %}
            <div id="competitionsContainer" class="leagues-grid">
                {% for comp in competitions %}
                <div class="league-card fade-in">
                    <!-- Avatar + Title -->
                    <div class="league-header">
                        <div class="league-avatar">
                            {{ comp.name[0]|upper if comp.name else 'üèÜ' }}
                        </div>
                        <h2 class="league-name">
                            <a href="{{ url_for('clubs_page', league=comp.name|lower, submitted=1) }}" class="league-name-link">
                                {{ comp.name or 'Unknown League' }}
                            </a>
                        </h2>
                    </div>

                    <!-- Info Section -->
                    <div class="league-info">
                        <div class="info-item">
                            <span class="info-label">üåç Country</span>
                            <span class="info-value">{{ comp.country_name or 'N/A' }}</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">üè∑Ô∏è League ID</span>
                            <span class="info-value">{{ comp.competition_id or 'N/A' }}</span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">üìå Major League?</span>
                            <span class="info-value">
                                {% if comp.is_major_league %}
                                    <span class="value-highlight">Yes</span>
                                {% else %}
                                    No
                                {% endif %}
                            </span>
                        </div>

                        <div class="info-item">
                            <span class="info-label">üîó URL</span>
                            <span class="info-value">
                                {% if comp.url %}
                                    <a href="{{ comp.url }}" target="_blank">Visit</a>
                                {% else %}
                                    N/A
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-results">No leagues found for the selected country.</div>
        {% endif %}
    {% else %}
        <div class="info-banner">Select a country and click 'Apply' to list that country's leagues.</div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Country Dropdown
    const countryDropdownBtn = document.getElementById('countryDropdownBtn');
    const countryDropdown = document.getElementById('countryDropdown');
    const countryInput = document.getElementById('countryInput');
    const countryButtonLabel = document.getElementById('countryButtonLabel');
    
    // Major League Dropdown
    const majorLeagueDropdownBtn = document.getElementById('majorLeagueDropdownBtn');
    const majorLeagueDropdown = document.getElementById('majorLeagueDropdown');
    const majorLeagueInput = document.getElementById('majorLeagueInput');
    const majorLeagueButtonLabel = document.getElementById('majorLeagueButtonLabel');
    
    // Toggle Country Dropdown
    if (countryDropdownBtn && countryDropdown) {
        countryDropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            countryDropdown.classList.toggle('show');
            // Close other dropdown
            if (majorLeagueDropdown) majorLeagueDropdown.classList.remove('show');
        });
        
        // Handle Country Selection
        const countryItems = countryDropdown.querySelectorAll('.sort-item');
        countryItems.forEach(item => {
            item.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const label = this.getAttribute('data-label');
                
                countryInput.value = value;
                countryButtonLabel.textContent = label || 'Select country';
                
                // Update active state
                countryItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Close dropdown
                countryDropdown.classList.remove('show');
            });
        });
    }
    
    // Toggle Major League Dropdown
    if (majorLeagueDropdownBtn && majorLeagueDropdown) {
        majorLeagueDropdownBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            majorLeagueDropdown.classList.toggle('show');
            // Close other dropdown
            if (countryDropdown) countryDropdown.classList.remove('show');
        });
        
        // Handle Major League Selection
        const majorLeagueItems = majorLeagueDropdown.querySelectorAll('.sort-item');
        majorLeagueItems.forEach(item => {
            item.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const label = this.getAttribute('data-label');
                
                majorLeagueInput.value = value;
                majorLeagueButtonLabel.textContent = label || 'All';
                
                // Update active state
                majorLeagueItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                
                // Close dropdown
                majorLeagueDropdown.classList.remove('show');
            });
        });
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        if (countryDropdown && !countryDropdown.contains(e.target) && !countryDropdownBtn.contains(e.target)) {
            countryDropdown.classList.remove('show');
        }
        if (majorLeagueDropdown && !majorLeagueDropdown.contains(e.target) && !majorLeagueDropdownBtn.contains(e.target)) {
            majorLeagueDropdown.classList.remove('show');
        }
    });
});
</script>
{% endblock %}
